# Custom Supply & Logistics App (CSLA) â€“Â Implementation Blueprint

> **Objective**Â Â Replace the current E2open stack with a lightweight, Titanâ€‘centric application suite that manages refinedâ€‘metal supply, logistics & inventory endâ€‘toâ€‘end while integrating natively with Transporeon (90â€¯% of moves) and 20 thirdâ€‘party DCs.

---

## 0Â Â Executive Snapshot

* **Products**Â Â 75 refined metals â€‘ tracked as 25â€¯t manufacturer lots â†’ 1â€¯t bundles (no partial splitting).
* **Throughput**Â Â â‰ˆâ€¯300 inbound lot releases & â‰ˆâ€¯600 customer deliveries / month (â‰ˆâ€¯6â€¯000 trucks).
* **Landscape (toâ€‘be)**

  ```txt
  React Frontâ€‘End â†’ CSLA Microâ€‘services â†’ Titan (realâ€‘time gRPC + Kafka)
                                 â†“
                           Transporeon (API / WS)
                                 â†“
                           20Ã— 3PL WMS (REST)
  ```
* **Hosting**Â Â Supabase Postgres + Edge Functions (public or private cloud) with optional NestJS heavy services on AKS.
* **Cutâ€‘over target**Â Â Q2â€‘2026.

---

## Main Business Requirements

* **Procurement** â€“ Manage purchase of refinedâ€‘metal lots (25â€¯t) & bundles (1â€¯t) with supplier confirmation, Incoterms, tolerance handling.
* **Customer Demand** â€“ Support sales orders with bundleâ€‘toâ€‘lot allocation ensuring full traceability & no partial bundles.
* **Logistics Visibility** â€“ Provide realâ€‘time inbound/outbound tracking: ASN ingestion, carrier milestones, weighâ€‘bridge variance control.
* **Transport Management** â€“ Create & monitor Transport Orders, integrated with Transporeon (â‰ˆâ€¯90â€¯%) and direct EDI carriers (â‰ˆâ€¯10â€¯%).
* **Granular Inventory** â€“ Maintain lot & bundle status, weight, purity, certificates across 20 3PLâ€‘managed DCs.
* **Titan Integration** â€“ Consume quotas & write back callâ€‘offs, inventory actuals, valuations in realâ€‘time (gRPC/Kafka) â€“ no nightly reconciles.
* **Compliance & Auditability** â€“ GDPR, chainâ€‘ofâ€‘custody, financial audit trails with immutable event log.
* **Performance** â€“ UI p95 <â€¯2â€¯s; DB baseline â‰¤â€¯200â€¯tx/s with autoâ€‘scaling.
* **Hosting & Security** â€“ Deployable to private or public cloud; RLS, mTLS, Azure AD SSO.
* **Migration Path** â€“ Dualâ€‘write, cutâ€‘over, and rollback strategy for E2open sunset.

---

## 1Â Â Capabilities & â€œDoneâ€‘Whenâ€ Criteria

| #  | Capability               | Metalâ€‘Specific Nuance                                                        | DoneÂ Whenâ€¦                                      |
| -- | ------------------------ | ---------------------------------------------------------------------------- | ----------------------------------------------- |
| 1  | **Bulk Purchase**        | PO lines in **bundles (1â€¯t)**; each PO references supplier **lotÂ ID (25â€¯t)** | Supplier confirms lot & bundle count            |
| 2  | **Customer Sales**       | Sales lines in bundles; system autoâ€‘maps to lots (traceability)              | Every bundle reserved to an exact lot           |
| 3  | **Logistics Planning**   | Plans built in 25â€¯t/50â€¯t truck or container loads                            | TransportÂ Order (TO) created & carrier assigned |
| 4  | **Inbound Visibility**   | ASN carries **lotÂ ID, bundle serials, netÂ wt.**                              | GRN posted, inventoryÂ stateÂ =Â â€œOnâ€‘handâ€         |
| 5  | **Outbound Visibility**  | Whole bundles only â€“ no partial picks                                        | POD received per bundle                         |
| 6  | **Transport Order Gen.** | TO payload enumerates bundleÂ IDs + grossâ€¯wt.                                 | Carrier accepts load                            |
| 7  | **Transport Execution**  | Weighâ€‘bridge variance <â€¯Â±0.5â€¯%                                               | All milestones completed                        |
| 8  | **Granular Inventory**   | HierarchyÂ =Â LotÂ (25â€¯t) â†’ 25â€¯Ã—â€¯BundleÂ (1â€¯t)                                   | Single source of truth reconciled               |
| 9  | **Transporeon Int.**     | Slot booking & webhook milestones                                            | Events matched to expected grossâ€¯wt.            |
| 10 | **Supplier / 3PL Int.**  | EDIÂ 850/856 or REST; chemistry certificates                                  | Data & docs linked to lot record                |

Bounded contexts: **Purchase â€¢ Sales â€¢ Inventory â€¢ Transport â€¢ Integration**.

---

## 2Â Â Target Technical Blueprint

### 2.1 Platform Stack

| Layer            | Selection                                                   | Rationale                                   |
| ---------------- | ----------------------------------------------------------- | ------------------------------------------- |
| DatabaseÂ +Â API   | **Supabase Postgres** (Rowâ€‘Level Security)                  | Lowâ€‘ops, realâ€‘time subscriptions            |
| Serverless Logic | Supabase Edge Functions (Deno/TS)                           | Close to data; <1â€¯s latency                 |
| Heavy Services   | Dockerâ€‘ised **NestJS (TS)** (only where Edge â‰ª)             | Transport optimisation, highâ€‘fanâ€‘out events |
| Event Mesh       | SupabaseÂ Realtime â†’ **Kafka / Redpanda** when scale demands | Matches Titan stream                        |
| Frontâ€‘End        | **ReactÂ 18 + Vite (TS)**                                    | Inâ€‘house mandate                            |
| Hosting          | Supabase Cloud **or** selfâ€‘host on AKS/OpenShift            | Public or private cloud option              |

### 2.2 ContextÂ â†’Â Schema Map

| Context     | Supabase Schema              | Notes                                 |
| ----------- | ---------------------------- | ------------------------------------- |
| Purchase    | **purchase**                 | POâ†”Lot validation Edge Fn             |
| Inventory   | **inventory**                | Lot & Bundle tables, RLS per 3PL/DC   |
| Sales       | **sales**                    | ATP & bundle allocation Fn            |
| Transport   | **transport** (+Â NestJS svc) | Transporeon webhook ingestion         |
| Integration | **integration**              | Supplier EDI parse, Titan gRPC client |

### 2.3 Domain Model (ERÂ excerpt)

```mermaid
erDiagram
  PURCHASE_ORDER ||--o{ PURCHASE_ORDER_LINE : contains
  PURCHASE_ORDER_LINE }o--|| INVENTORY_LOT : references
  INVENTORY_LOT ||--|{ INVENTORY_BUNDLE : contains
  SALES_ORDER ||--o{ SALES_ORDER_LINE : contains
  SALES_ORDER_LINE }o--|| INVENTORY_BUNDLE : allocates
  TRANSPORT_ORDER ||--o{ TRANSPORT_STOP : has
  TRANSPORT_ORDER ||--o{ TRANSPORT_MILESTONE : tracks
```

---

## 3Â Â Key API Contracts (OpenAPI excerpts)

```yaml
POST /purchase-orders
  body:
    supplier_id: string
    incoterm: string
    lines:
      - lot_id: string   # 25â€¯t lot
        bundle_qty: 25   # integer bundles (1â€¯t each)
        purity_pct: 99.97
        due_date: date

POST /sales-orders
  body:
    customer_id: string
    lines:
      - bundle_qty: 10
        requested_date: date

POST /transport-orders
  body:
    shipment_plan_id: uuid
    carrier_id: string
    equipment: "Truckâ€‘25t"
    stops: [...]
```

Event topics (`JSON/Avro`):

* `lot.created`, `bundle.located`, `so.released`, `to.milestone.*`

---

## 4Â Â Process Flows

### 4.1 Procureâ€‘toâ€‘Receive

1. **Create PO** (`purchase_order`)
2. Supplier sends **EDIÂ 856** â†’ Edge Fn â†’ stub `inventory_lot` + `inventory_bundle` rows
3. Truck arrives; 3PL scans bundles â†’ REST call updates `bundle.status='Onâ€‘hand'`

### 4.2 Orderâ€‘toâ€‘Deliver

1. React UI posts SO â†’ Fn `allocate_bundles(so_id)` (RLS enforces DC)
2. Bundles reserved â†’ Planner creates TO â†’ Fn books Transporeon slot
3. Webhook milestones stream to UI; POD event closes SO, sets bundles `Delivered`

---

## 5Â Â Integration Blueprint (Titanâ€‘centric)

| Object               | Direction                | Mechanism               | Frequency |
| -------------------- | ------------------------ | ----------------------- | --------- |
| Quota header/line    | **Titan â†’ Kafka â†’ CSLA** | CDC stream              | Realâ€‘time |
| Callâ€‘off             | CSLA â†’ Titan             | gRPC `CreateCalloff`    | Sync      |
| Lot actuals          | CSLA â†’ Titan             | Kafka `inv.lot.updated` | Event     |
| Transport milestones | Transporeon â†’ CSLA       | WebSocket               | Async     |
| 3PL WMS events       | 3PL â†’ CSLA               | REST POST               | Per scan  |

*No Salesforce integrations â€“ forecasts originate in Titan spreadsheets or CSLA CSV upload.*

---

## 6Â Â Nonâ€‘Functional Targets

| Aspect       | Baseline                         | Headroom                       |
| ------------ | -------------------------------- | ------------------------------ |
| DB TPS       | <â€¯200Â tx/s                       | Supabase autoâ€‘scales to 1â€¯000+ |
| UI latency   | p95Â <Â 250â€¯ms                     | Edge Fn <Â 1â€¯s budget           |
| Availability | 99.5â€¯% (Supabase Cloud)          | 99.9â€¯%+ selfâ€‘host HA           |
| Security     | Supabase AuthÂ +Â RLS; mTLS to 3PL | Add Keycloak SSO if required   |

---

## 7Â Â Migration & Coâ€‘existence Plan

| Phase    | Task                                                                               |
| -------- | ---------------------------------------------------------------------------------- |
| Tâ€‘1Â Mo   | Freeze new Callâ€‘offs in E2open; dualâ€‘write to CSLA for regression                  |
| Cutâ€‘over | Export open Trades/Callâ€‘offs/TO/Lots â†’ Azure Blob â†’ Migrâ€‘script loads Titan & CSLA |
| T+1Â Wk   | Transporeon creds switched to CSLA; decommission E2open listeners                  |

---

## 8Â Â Open Decisions (highlight for steeringâ€‘committee)

| ID | Topic                | OptionÂ A (default)            | OptionÂ B                  |
| -- | -------------------- | ----------------------------- | ------------------------- |
| A  | **Purity & SKU**     | Separate SKU per purity grade | Attributeâ€‘only            |
| B  | **Cert storage**     | Supabase Storage blob         | External object store     |
| C  | **Weight tolerance** | Block shipmentÂ >â€¯Â±0.5â€¯%       | Configurable per customer |
| D  | **Billing unit**     | Fullâ€‘tonne rounded            | Actual weighâ€‘bridge kg    |

---

## 9Â Â Next Steps

1. Ratify open decisions Aâ€“D.
2. Generate Supabase migration scripts for schemas above.
3. Scaffold React screens: *Target Loader*, *Callâ€‘off Workbench*, *Transport Board*.
4. Build Edge Functions stubs + gRPC client for Titan.
5. Schedule dualâ€‘write rehearsal in preâ€‘prod.

---

*PreparedÂ JulyÂ 12Â 2025 by Accenture Supplyâ€‘Chain Technology*

---

## 10  Task Management Process

### 10.1 Task Completion Workflow
When a task is completed, Claude must:
1. **Update task status** in the individual task file: `**Status**: ðŸ”´ Pending Approval` â†’ `**Status**: âœ… COMPLETED`
2. **Move task file** from `Docs/tasks/` to `Docs/tasks/completed tasks/`
3. **Update todo list** to mark task as completed
4. **Deploy changes** to development branch

### 10.2 Task File Structure
```markdown
# Task XXX: Category - Task Name
**Status**: âœ… COMPLETED  
**Priority**: High/Medium/Low  
**Estimated Effort**: X hours  
**Prerequisites**: Previous task dependencies
```

### 10.3 Active Task Tracking
- Todo list maintained via TodoWrite tool
- Git commits follow conventional format with Claude Code attribution
- Working tree should be clean before starting new tasks

---

*Updated July 13 2025 with Task Management Process*
EOF < /dev/null